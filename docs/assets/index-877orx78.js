(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();class on{constructor(){this.rows=6,this.cols=7,this.board=[],this.currentPlayer=1,this.winner=null,this.reset()}reset(){this.board=Array(this.rows).fill(null).map(()=>Array(this.cols).fill(0)),this.currentPlayer=1,this.winner=null}dropPiece(t){if(this.winner||t<0||t>=this.cols)return null;for(let n=this.rows-1;n>=0;n--)if(this.board[n][t]===0)return this.board[n][t]=this.currentPlayer,this.checkWin(n,t)?this.winner=this.currentPlayer:this.currentPlayer=this.currentPlayer===1?2:1,{row:n,col:t,player:this.board[n][t]};return null}checkWin(t,n){const o=this.board[t][n],s=[[0,1],[1,0],[1,1],[1,-1]];for(const[r,l]of s){let m=1;for(let d=1;d<4;d++){const p=t+r*d,u=n+l*d;if(p<0||p>=this.rows||u<0||u>=this.cols||this.board[p][u]!==o)break;m++}for(let d=1;d<4;d++){const p=t-r*d,u=n-l*d;if(p<0||p>=this.rows||u<0||u>=this.cols||this.board[p][u]!==o)break;m++}if(m>=4)return!0}return!1}}const vt={p:0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2fn,n:0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n,h:1n,a:0n,b:7n,Gx:0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Gy:0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n},{p:z,n:ve,Gx:rn,Gy:an,b:Rt}=vt,N=32,ge=64,Ke={publicKey:N+1,publicKeyUncompressed:ge+1,seed:N+N/2},cn=(...e)=>{"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(...e)},C=(e="")=>{const t=new Error(e);throw cn(t,C),t},ln=e=>typeof e=="bigint",dn=e=>typeof e=="string",un=e=>e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array",K=(e,t,n="")=>{const o=un(e),s=e?.length,r=t!==void 0;if(!o||r&&s!==t){const l=n&&`"${n}" `,m=r?` of length ${t}`:"",d=o?`length=${s}`:`type=${typeof e}`;C(l+"expected Uint8Array"+m+", got "+d)}return e},be=e=>new Uint8Array(e),St=(e,t)=>e.toString(16).padStart(t,"0"),At=e=>Array.from(K(e)).map(t=>St(t,2)).join(""),X={_0:48,_9:57,A:65,F:70,a:97,f:102},st=e=>{if(e>=X._0&&e<=X._9)return e-X._0;if(e>=X.A&&e<=X.F)return e-(X.A-10);if(e>=X.a&&e<=X.f)return e-(X.a-10)},Pt=e=>{const t="hex invalid";if(!dn(e))return C(t);const n=e.length,o=n/2;if(n%2)return C(t);const s=be(o);for(let r=0,l=0;r<o;r++,l+=2){const m=st(e.charCodeAt(l)),d=st(e.charCodeAt(l+1));if(m===void 0||d===void 0)return C(t);s[r]=m*16+d}return s},Ct=()=>globalThis?.crypto,ot=()=>Ct()?.subtle??C("crypto.subtle must be defined, consider polyfill"),de=(...e)=>{const t=be(e.reduce((o,s)=>o+K(s).length,0));let n=0;return e.forEach(o=>{t.set(o,n),n+=o.length}),t},Je=(e=N)=>Ct().getRandomValues(be(e)),De=BigInt,se=(e,t,n,o="bad number: out of range")=>ln(e)&&t<=e&&e<n?e:C(o),f=(e,t=z)=>{const n=e%t;return n>=0n?n:t+n},He=e=>f(e,ve),fn=(e,t)=>{(e===0n||t<=0n)&&C("no inverse n="+e+" mod="+t);let n=f(e,t),o=t,s=0n,r=1n;for(;n!==0n;){const l=o/n,m=o%n,d=s-r*l;o=n,n=m,s=r,r=d}return o===1n?f(s,t):C("no inverse")},hn=e=>{const t=Bt[e];return typeof t!="function"&&C("hashes."+e+" not set"),t},$e=e=>e instanceof G?e:C("Point expected"),Tt=e=>f(f(e*e)*e+Rt),rt=e=>se(e,0n,z),Le=e=>se(e,1n,z),mn=e=>se(e,1n,ve),ue=e=>(e&1n)===0n,xt=e=>Uint8Array.of(e),yn=e=>xt(ue(e)?2:3),Mt=e=>{const t=Tt(Le(e));let n=1n;for(let o=t,s=(z+1n)/4n;s>0n;s>>=1n)s&1n&&(n=n*o%z),o=o*o%z;return f(n*n)===t?n:C("sqrt invalid")};class G{static BASE;static ZERO;X;Y;Z;constructor(t,n,o){this.X=rt(t),this.Y=Le(n),this.Z=rt(o),Object.freeze(this)}static CURVE(){return vt}static fromAffine(t){const{x:n,y:o}=t;return n===0n&&o===0n?te:new G(n,o,1n)}static fromBytes(t){K(t);const{publicKey:n,publicKeyUncompressed:o}=Ke;let s;const r=t.length,l=t[0],m=t.subarray(1),d=_e(m,0,N);if(r===n&&(l===2||l===3)){let p=Mt(d);const u=ue(p);ue(De(l))!==u&&(p=f(-p)),s=new G(d,p,1n)}return r===o&&l===4&&(s=new G(d,_e(m,N,ge),1n)),s?s.assertValidity():C("bad point: not on curve")}static fromHex(t){return G.fromBytes(Pt(t))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(t){const{X:n,Y:o,Z:s}=this,{X:r,Y:l,Z:m}=$e(t),d=f(n*m),p=f(r*s),u=f(o*m),c=f(l*s);return d===p&&u===c}is0(){return this.equals(te)}negate(){return new G(this.X,f(-this.Y),this.Z)}double(){return this.add(this)}add(t){const{X:n,Y:o,Z:s}=this,{X:r,Y:l,Z:m}=$e(t),d=0n,p=Rt;let u=0n,c=0n,i=0n;const g=f(p*3n);let v=f(n*r),A=f(o*l),T=f(s*m),D=f(n+o),x=f(r+l);D=f(D*x),x=f(v+A),D=f(D-x),x=f(n+s);let I=f(r+m);return x=f(x*I),I=f(v+T),x=f(x-I),I=f(o+s),u=f(l+m),I=f(I*u),u=f(A+T),I=f(I-u),i=f(d*x),u=f(g*T),i=f(u+i),u=f(A-i),i=f(A+i),c=f(u*i),A=f(v+v),A=f(A+v),T=f(d*T),x=f(g*x),A=f(A+T),T=f(v-T),T=f(d*T),x=f(x+T),v=f(A*x),c=f(c+v),v=f(I*x),u=f(D*u),u=f(u-v),v=f(D*A),i=f(I*i),i=f(i+v),new G(u,c,i)}subtract(t){return this.add($e(t).negate())}multiply(t,n=!0){if(!n&&t===0n)return te;if(mn(t),t===1n)return this;if(this.equals(oe))return Tn(t).p;let o=te,s=oe;for(let r=this;t>0n;r=r.double(),t>>=1n)t&1n?o=o.add(r):n&&(s=s.add(r));return o}multiplyUnsafe(t){return this.multiply(t,!1)}toAffine(){const{X:t,Y:n,Z:o}=this;if(this.equals(te))return{x:0n,y:0n};if(o===1n)return{x:t,y:n};const s=fn(o,z);return f(o*s)!==1n&&C("inverse invalid"),{x:f(t*s),y:f(n*s)}}assertValidity(){const{x:t,y:n}=this.toAffine();return Le(t),Le(n),f(n*n)===Tt(t)?this:C("bad point: not on curve")}toBytes(t=!0){const{x:n,y:o}=this.assertValidity().toAffine(),s=j(n);return t?de(yn(o),s):de(xt(4),s,j(o))}toHex(t){return At(this.toBytes(t))}}const oe=new G(rn,an,1n),te=new G(0n,1n,0n);G.BASE=oe;G.ZERO=te;const pn=(e,t,n)=>oe.multiply(t,!1).add(e.multiply(n,!1)).assertValidity(),re=e=>De("0x"+(At(e)||"0")),_e=(e,t,n)=>re(e.subarray(t,n)),gn=2n**256n,j=e=>Pt(St(se(e,0n,gn),ge)),bn=e=>{const t=re(K(e,N,"secret key"));return se(t,1n,ve,"invalid secret key: outside of range")},at="SHA-256",Bt={hmacSha256Async:async(e,t)=>{const n=ot(),o="HMAC",s=await n.importKey("raw",e,{name:o,hash:{name:at}},!1,["sign"]);return be(await n.sign(o,s,t))},hmacSha256:void 0,sha256Async:async e=>be(await ot().digest(at,e)),sha256:void 0},wn=(e=Je(Ke.seed))=>{K(e),(e.length<Ke.seed||e.length>1024)&&C("expected 40-1024b");const t=f(re(e),ve-1n);return j(t+1n)},kn=e=>t=>{const n=wn(t);return{secretKey:n,publicKey:e(n)}},Lt=e=>Uint8Array.from("BIP0340/"+e,t=>t.charCodeAt(0)),Et="aux",It="nonce",Ot="challenge",je=(e,...t)=>{const n=hn("sha256"),o=n(Lt(e));return n(de(o,o,...t))},Fe=async(e,...t)=>{const n=Bt.sha256Async,o=await n(Lt(e));return await n(de(o,o,...t))},We=e=>{const t=bn(e),n=oe.multiply(t),{x:o,y:s}=n.assertValidity().toAffine(),r=ue(s)?t:He(-t),l=j(o);return{d:r,px:l}},ze=e=>He(re(e)),Ut=(...e)=>ze(je(Ot,...e)),Dt=async(...e)=>ze(await Fe(Ot,...e)),_t=e=>We(e).px,vn=kn(_t),Gt=(e,t,n)=>{const{px:o,d:s}=We(t);return{m:K(e),px:o,d:s,a:K(n,N)}},Nt=e=>{const t=ze(e);t===0n&&C("sign failed: k is zero");const{px:n,d:o}=We(j(t));return{rx:n,k:o}},Ht=(e,t,n,o)=>de(t,j(He(e+n*o))),Yt="invalid signature produced",Rn=(e,t,n=Je(N))=>{const{m:o,px:s,d:r,a:l}=Gt(e,t,n),m=je(Et,l),d=j(r^re(m)),p=je(It,d,s,o),{rx:u,k:c}=Nt(p),i=Ut(u,s,o),g=Ht(c,u,i,r);return Kt(g,o,s)||C(Yt),g},Sn=async(e,t,n=Je(N))=>{const{m:o,px:s,d:r,a:l}=Gt(e,t,n),m=await Fe(Et,l),d=j(r^re(m)),p=await Fe(It,d,s,o),{rx:u,k:c}=Nt(p),i=await Dt(u,s,o),g=Ht(c,u,i,r);return await jt(g,o,s)||C(Yt),g},An=(e,t)=>e instanceof Promise?e.then(t):t(e),$t=(e,t,n,o)=>{const s=K(e,ge,"signature"),r=K(t,void 0,"message"),l=K(n,N,"publicKey");try{const m=re(l),d=Mt(m),p=ue(d)?d:f(-d),u=new G(m,p,1n).assertValidity(),c=j(u.toAffine().x),i=_e(s,0,N);se(i,1n,z);const g=_e(s,N,ge);se(g,1n,ve);const v=de(j(i),c,r);return An(o(v),A=>{const{x:T,y:D}=pn(u,g,He(-A)).toAffine();return!(!ue(D)||T!==i)})}catch{return!1}},Kt=(e,t,n)=>$t(e,t,n,Ut),jt=async(e,t,n)=>$t(e,t,n,Dt),Ft={keygen:vn,getPublicKey:_t,sign:Rn,verify:Kt,signAsync:Sn,verifyAsync:jt},Ge=8,Pn=256,Qt=Math.ceil(Pn/Ge)+1,Qe=2**(Ge-1),Cn=()=>{const e=[];let t=oe,n=t;for(let o=0;o<Qt;o++){n=t,e.push(n);for(let s=1;s<Qe;s++)n=n.add(t),e.push(n);t=n.double()}return e};let ct;const it=(e,t)=>{const n=t.negate();return e?n:t},Tn=e=>{const t=ct||(ct=Cn());let n=te,o=oe;const s=2**Ge,r=s,l=De(s-1),m=De(Ge);for(let d=0;d<Qt;d++){let p=Number(e&l);e>>=m,p>Qe&&(p-=r,e+=1n);const u=d*Qe,c=u,i=u+Math.abs(p)-1,g=d%2!==0,v=p<0;p===0?o=o.add(it(g,t[c])):n=n.add(it(v,t[i]))}return e!==0n&&C("invalid wnaf"),{p:n,f:o}},{floor:Ze,random:xn,sin:Mn}=Math,we="Trystero",ke=(e,t)=>Array(e).fill().map(t),lt="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",qe=e=>ke(e,()=>lt[Ze(xn()*lt.length)]).join(""),ie=qe(20),ne=Promise.all.bind(Promise),Zt=typeof window<"u",{entries:dt,fromEntries:Bn,keys:Ln}=Object,V=()=>{},J=e=>new Error(`${we}: ${e}`),En=new TextEncoder,In=new TextDecoder,le=e=>En.encode(e),Ee=e=>In.decode(e),Xe=e=>e.reduce((t,n)=>t+n.toString(16).padStart(2,"0"),""),Te=(...e)=>e.join("@"),On=(e,t)=>{const n=[...e],o=()=>{const r=Mn(t++)*1e4;return r-Ze(r)};let s=n.length;for(;s;){const r=Ze(o()*s--);[n[s],n[r]]=[n[r],n[s]]}return n},Un=(e,t,n,o)=>(e.relayUrls||On(t,qt(e.appId))).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||n),W=JSON.stringify,Ne=JSON.parse,qt=(e,t=Number.MAX_SAFE_INTEGER)=>e.split("").reduce((n,o)=>n+o.charCodeAt(0),0)%t,ut=3333,xe={};let pe=null,Ve=null;const Dn=()=>{pe||(pe=new Promise(e=>{Ve=e}).finally(()=>{Ve=null,pe=null}))},_n=()=>Ve?.(),Gn=(e,t)=>{const n={},o=()=>{const s=new WebSocket(e);s.onclose=()=>{if(pe){pe.then(o);return}xe[e]??=ut,setTimeout(o,xe[e]),xe[e]*=2},s.onmessage=r=>t(r.data),n.socket=s,n.url=s.url,n.ready=new Promise(r=>s.onopen=()=>{r(n),xe[e]=ut}),n.send=r=>{s.readyState===1&&s.send(r)}};return o(),n},Nn=()=>{if(Zt){const e=new AbortController;return addEventListener("online",_n,{signal:e.signal}),addEventListener("offline",Dn,{signal:e.signal}),()=>e.abort()}return V},et="AES-GCM",Hn={},Yn=e=>btoa(String.fromCharCode.apply(null,new Uint8Array(e))),$n=e=>{const t=atob(e);return new Uint8Array(t.length).map((n,o)=>t.charCodeAt(o)).buffer},Xt=async(e,t)=>new Uint8Array(await crypto.subtle.digest(e,le(t))),Me=async e=>Hn[e]||=Array.from(await Xt("SHA-1",e)).map(t=>t.toString(36)).join(""),Kn=async(e,t,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},le(`${e}:${t}:${n}`)),{name:et},!1,["encrypt","decrypt"]),Vt="$",Jt=",",jn=async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16));return n.join(Jt)+Vt+Yn(await crypto.subtle.encrypt({name:et,iv:n},await e,le(t)))},Fn=async(e,t)=>{const[n,o]=t.split(Vt);return Ee(await crypto.subtle.decrypt({name:et,iv:new Uint8Array(n.split(Jt))},await e,$n(o)))},Qn=5e3,ft="icegatheringstatechange",ht="offer",Zn="answer",mt=(e,{rtcConfig:t,rtcPolyfill:n,turnConfig:o})=>{const s=new(n||RTCPeerConnection)({iceServers:qn.concat(o||[]),...t}),r={};let l=!1,m=!1,d=null;const p=c=>{c.binaryType="arraybuffer",c.bufferedAmountLowThreshold=65535,c.onmessage=i=>r.data?.(i.data),c.onopen=()=>r.connect?.(),c.onclose=()=>r.close?.(),c.onerror=i=>r.error?.(i)},u=c=>Promise.race([new Promise(i=>{const g=()=>{c.iceGatheringState==="complete"&&(c.removeEventListener(ft,g),i())};c.addEventListener(ft,g),g()}),new Promise(i=>setTimeout(i,Qn))]).then(()=>({type:c.localDescription.type,sdp:c.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")}));return e?(d=s.createDataChannel("data"),p(d)):s.ondatachannel=({channel:c})=>{d=c,p(c)},s.onnegotiationneeded=async()=>{try{l=!0,await s.setLocalDescription();const c=await u(s);r.signal?.(c)}catch(c){r.error?.(c)}finally{l=!1}},s.onconnectionstatechange=()=>{["disconnected","failed","closed"].includes(s.connectionState)&&r.close?.()},s.ontrack=c=>{r.track?.(c.track,c.streams[0]),r.stream?.(c.streams[0])},s.onremovestream=c=>r.stream?.(c.stream),e&&(s.canTrickleIceCandidates||s.onnegotiationneeded()),{created:Date.now(),connection:s,get channel(){return d},get isDead(){return s.connectionState==="closed"},async signal(c){if(!(d?.readyState==="open"&&!c.sdp?.includes("a=rtpmap")))try{if(c.type===ht){if(l||s.signalingState!=="stable"&&!m){if(e)return;await ne([s.setLocalDescription({type:"rollback"}),s.setRemoteDescription(c)])}else await s.setRemoteDescription(c);await s.setLocalDescription();const i=await u(s);return r.signal?.(i),i}else if(c.type===Zn){m=!0;try{await s.setRemoteDescription(c)}finally{m=!1}}}catch(i){r.error?.(i)}},sendData:c=>d.send(c),destroy:()=>{d?.close(),s.close(),l=!1,m=!1},setHandlers:c=>Object.assign(r,c),offerPromise:e?new Promise(c=>r.signal=i=>{i.type===ht&&c(i)}):Promise.resolve(),addStream:c=>c.getTracks().forEach(i=>s.addTrack(i,c)),removeStream:c=>s.getSenders().filter(i=>c.getTracks().includes(i.track)).forEach(i=>s.removeTrack(i)),addTrack:(c,i)=>s.addTrack(c,i),removeTrack:c=>{const i=s.getSenders().find(g=>g.track===c);i&&s.removeTrack(i)},replaceTrack:(c,i)=>{const g=s.getSenders().find(v=>v.track===c);if(g)return g.replaceTrack(i)}}},qn=[...ke(3,(e,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:stun.cloudflare.com:3478"].map(e=>({urls:e})),Xn=Object.getPrototypeOf(Uint8Array),Ie=12,Wt=0,Oe=Wt+Ie,Ue=Oe+1,me=Ue+1,ye=me+1,ee=16*2**10-ye,Be=255,yt="bufferedamountlow",ce=e=>"@_"+e,Vn=(e,t,n)=>{const o={},s={},r={},l={},m={},d={},p={},u={onPeerJoin:V,onPeerLeave:V,onPeerStream:V,onPeerTrack:V},c=(a,h)=>(a?Array.isArray(a)?a:[a]:Ln(o)).flatMap(w=>{const k=o[w];return k?h(w,k):(console.warn(`${we}: no peer with id ${w} found`),[])}),i=a=>{o[a]&&(o[a].destroy(),delete o[a],delete l[a],delete m[a],u.onPeerLeave(a),t(a))},g=a=>{if(s[a])return r[a];if(!a)throw J("action type argument is required");const h=le(a);if(h.byteLength>Ie)throw J(`action type string "${a}" (${h.byteLength}b) exceeds byte limit (${Ie}). Hint: choose a shorter name.`);const w=new Uint8Array(Ie);w.set(h);let k=0;return s[a]={onComplete:V,onProgress:V,setOnComplete:S=>s[a]={...s[a],onComplete:S},setOnProgress:S=>s[a]={...s[a],onProgress:S},send:async(S,y,b,P)=>{if(b&&typeof b!="object")throw J("action meta argument must be an object");const _=typeof S;if(_==="undefined")throw J("action data cannot be undefined");const B=_!=="string",F=S instanceof Blob,R=F||S instanceof ArrayBuffer||S instanceof Xn;if(b&&!R)throw J("action meta argument can only be used with binary data");const O=R?new Uint8Array(F?await S.arrayBuffer():S):le(B?W(S):S),$=b?le(W(b)):null,M=Math.ceil(O.byteLength/ee)+(b?1:0)||1,L=ke(M,(E,U)=>{const Q=U===M-1,Z=b&&U===0,q=new Uint8Array(ye+(Z?$.byteLength:Q?O.byteLength-ee*(M-(b?2:1)):ee));return q.set(w),q.set([k],Oe),q.set([Q|Z<<1|R<<2|B<<3],Ue),q.set([Math.round((U+1)/M*Be)],me),q.set(b?Z?$:O.subarray((U-1)*ee,U*ee):O.subarray(U*ee,(U+1)*ee),ye),q});return k=k+1&Be,ne(c(y,async(E,U)=>{const{channel:Q}=U;let Z=0;for(;Z<M;){const q=L[Z];if(Q.bufferedAmount>Q.bufferedAmountLowThreshold&&await new Promise(sn=>{const nt=()=>{Q.removeEventListener(yt,nt),sn()};Q.addEventListener(yt,nt)}),!o[E])break;U.sendData(q),Z++,P?.(q[me]/Be,E,b)}}))}},r[a]||=[s[a].send,s[a].setOnComplete,s[a].setOnProgress]},v=(a,h)=>{const w=new Uint8Array(h),k=Ee(w.subarray(Wt,Oe)).replaceAll("\0",""),[S]=w.subarray(Oe,Ue),[y]=w.subarray(Ue,me),[b]=w.subarray(me,ye),P=w.subarray(ye),_=!!(y&1),B=!!(y&2),F=!!(y&4),R=!!(y&8);if(!s[k]){console.warn(`${we}: received message with unregistered type (${k})`);return}l[a]||={},l[a][k]||={};const O=l[a][k][S]||={chunks:[]};if(B?O.meta=Ne(Ee(P)):O.chunks.push(P),s[k].onProgress(b/Be,a,O.meta),!_)return;const $=new Uint8Array(O.chunks.reduce((M,L)=>M+L.byteLength,0));if(O.chunks.reduce((M,L)=>($.set(L,M),M+L.byteLength),0),delete l[a][k][S],F)s[k].onComplete($,a,O.meta);else{const M=Ee($);s[k].onComplete(R?Ne(M):M,a)}},A=async()=>{await Pe(""),await new Promise(a=>setTimeout(a,99)),dt(o).forEach(([a,h])=>{h.destroy(),delete o[a]}),n()},[T,D]=g(ce("ping")),[x,I]=g(ce("pong")),[Re,Se]=g(ce("signal")),[Ae,fe]=g(ce("stream")),[ae,Ye]=g(ce("track")),[Pe,Ce]=g(ce("leave"));return e((a,h)=>{o[h]||(o[h]=a,a.setHandlers({data:w=>v(h,w),stream:w=>{u.onPeerStream(w,h,d[h]),delete d[h]},track:(w,k)=>{u.onPeerTrack(w,k,h,p[h]),delete p[h]},signal:w=>Re(w,h),close:()=>i(h),error:w=>{console.error(w),i(h)}}),u.onPeerJoin(h))}),D((a,h)=>x("",h)),I((a,h)=>{m[h]?.(),delete m[h]}),Se((a,h)=>o[h]?.signal(a)),fe((a,h)=>d[h]=a),Ye((a,h)=>p[h]=a),Ce((a,h)=>i(h)),Zt&&addEventListener("beforeunload",A),{makeAction:g,leave:A,ping:async a=>{if(!a)throw J("ping() must be called with target peer ID");const h=Date.now();return T("",a),await new Promise(w=>m[a]=w),Date.now()-h},getPeers:()=>Bn(dt(o).map(([a,h])=>[a,h.connection])),addStream:(a,h,w)=>c(h,async(k,S)=>{w&&await Ae(w,k),S.addStream(a)}),removeStream:(a,h)=>c(h,(w,k)=>k.removeStream(a)),addTrack:(a,h,w,k)=>c(w,async(S,y)=>{k&&await ae(k,S),y.addTrack(a,h)}),removeTrack:(a,h)=>c(h,(w,k)=>k.removeTrack(a)),replaceTrack:(a,h,w,k)=>c(w,async(S,y)=>{k&&await ae(k,S),y.replaceTrack(a,h)}),onPeerJoin:a=>u.onPeerJoin=a,onPeerLeave:a=>u.onPeerLeave=a,onPeerStream:a=>u.onPeerStream=a,onPeerTrack:a=>u.onPeerTrack=a}},Jn=20,Wn=5333,pt=57333,zn=({init:e,subscribe:t,announce:n})=>{const o={};let s=!1,r,l,m,d;return(p,u,c)=>{const{appId:i}=p;if(o[i]?.[u])return o[i][u];const g={},v={},A=Te(we,i,u),T=Me(A),D=Me(Te(A,ie)),x=Kn(p.password||"",i,u),I=y=>async b=>({type:b.type,sdp:await y(x,b.sdp)}),Re=I(Fn),Se=I(jn),Ae=()=>mt(!0,p),fe=(y,b,P)=>{if(v[b]){v[b]!==y&&y.destroy();return}v[b]=y,S(y,b),g[b]?.forEach((_,B)=>{B!==P&&_.destroy()}),delete g[b]},ae=(y,b)=>{v[b]===y&&delete v[b]},Ye=(y,b)=>{if(v[y])return;const P=g[y]?.[b];P&&(delete g[y][b],P.destroy())},Pe=y=>(l.push(...ke(y,Ae)),ne(l.splice(0,y).map(b=>b.offerPromise.then(Se).then(P=>({peer:b,offer:P}))))),Ce=(y,b)=>c?.({error:`incorrect password (${p.password}) when decrypting ${b}`,appId:i,peerId:y,roomId:u}),a=y=>async(b,P,_)=>{const[B,F]=await ne([T,D]);if(b!==B&&b!==F)return;const{peerId:R,offer:O,answer:$,peer:M}=typeof P=="string"?Ne(P):P;if(!(R===ie||v[R])){if(R&&!O&&!$){if(g[R]?.[y])return;const[[{peer:L,offer:E}],U]=await ne([Pe(1),Me(Te(A,R))]);g[R]||=[],g[R][y]=L,setTimeout(()=>Ye(R,y),h[y]*.9),L.setHandlers({connect:()=>fe(L,R,y),close:()=>ae(L,R)}),_(U,W({peerId:ie,offer:E}))}else if(O){if(g[R]?.[y]&&ie>R)return;const E=mt(!1,p);E.setHandlers({connect:()=>fe(E,R,y),close:()=>ae(E,R)});let U;try{U=await Re(O)}catch{Ce(R,"offer");return}if(E.isDead)return;const[Q,Z]=await ne([Me(Te(A,R)),E.signal(U)]);_(Q,W({peerId:ie,answer:await Se(Z)}))}else if($){let L;try{L=await Re($)}catch{Ce(R,"answer");return}if(M)M.setHandlers({connect:()=>fe(M,R,y),close:()=>ae(M,R)}),M.signal(L);else{const E=g[R]?.[y];E&&!E.isDead&&E.signal(L)}}}};if(!p)throw J("requires a config map as the first argument");if(!i&&!p.firebaseApp)throw J("config map is missing appId field");if(!u)throw J("roomId argument required");if(!s){const y=e(p);l=ke(Jn,Ae),r=Array.isArray(y)?y:[y],s=!0,m=setInterval(()=>l=l.filter(b=>{const P=Date.now()-b.created<pt;return P||b.destroy(),P}),pt*1.03),d=p.manualRelayReconnection?V:Nn()}const h=r.map(()=>Wn),w=[],k=r.map(async(y,b)=>t(await y,await T,await D,a(b),Pe));ne([T,D]).then(([y,b])=>{const P=async(_,B)=>{const F=await n(_,y,b);typeof F=="number"&&(h[B]=F),w[B]=setTimeout(()=>P(_,B),h[B])};k.forEach(async(_,B)=>{await _,P(await r[B],B)})});let S=V;return o[i]||={},o[i][u]=Vn(y=>S=y,y=>delete v[y],()=>{delete o[i][u],w.forEach(clearTimeout),k.forEach(async y=>(await y)()),clearInterval(m),d(),s=!1})}},es=5,zt="x",en="EVENT",{secretKey:ts,publicKey:ns}=Ft.keygen(),ss=Xe(ns),tt={},he={},os={},tn=()=>Math.floor(Date.now()/1e3),nn=e=>os[e]??=qt(e,1e4)+2e4,gt=async(e,t)=>{const n={kind:nn(e),tags:[[zt,e]],created_at:tn(),content:t,pubkey:ss},o=await Xt("SHA-256",W([0,n.pubkey,n.created_at,n.kind,n.tags,n.content]));return W([en,{...n,id:Xe(o),sig:Xe(await Ft.signAsync(o,ts))}])},bt=(e,t)=>(tt[e]=t,W(["REQ",e,{kinds:[nn(t)],since:tn(),["#"+zt]:[t]}])),wt=e=>(delete tt[e],W(["CLOSE",e])),kt=zn({init:e=>Un(e,rs,es).map(t=>{const n=Gn(t,o=>{const[s,r,l,m]=Ne(o);if(s!==en){const d=`${we}: relay failure from ${n.url} - `;s==="NOTICE"?console.warn(d+r):s==="OK"&&!l&&console.warn(d+m);return}he[r]?.(tt[r],l.content)});return n.ready}),subscribe:(e,t,n,o)=>{const s=qe(64),r=qe(64);return he[s]=he[r]=(l,m)=>o(l,m,async(d,p)=>e.send(await gt(d,p))),e.send(bt(s,t)),e.send(bt(r,n)),()=>{e.send(wt(s)),e.send(wt(r)),delete he[s],delete he[r]}},announce:async(e,t)=>e.send(await gt(t,W({peerId:ie})))}),rs=["black.nostrcity.club","ftp.halifax.rwth-aachen.de/nostr","nos.lol","nostr.cool110.xyz","nostr.data.haus","nostr.sathoarder.com","nostr.vulpem.com","relay.agorist.space","relay.binaryrobot.com","relay.damus.io","relay.fountain.fm","relay.mostro.network","relay.nostraddress.com","relay.nostrdice.com","relay.nostromo.social","relay.oldenburg.cool","relay.verified-nostr.com","yabu.me/v2"].map(e=>"wss://"+e);class as{constructor(){this.lobbyRoom=null,this.gameRoom=null,this.onMatchFoundCallback=null,this.onMoveReceivedCallback=null,this.onPeerDisconnectCallback=null,this.onSurrenderReceivedCallback=null,this.onRematchReceivedCallback=null,this.onQuitReceivedCallback=null,this.isHost=!1,this.peerId=null,this.matchmakingId=null}joinLobby(){const t={appId:"connect4-webrtc-game"};this.lobbyRoom=kt(t,"connect4-global-lobby"),this.matchmakingId=crypto.randomUUID();const[n,o]=this.lobbyRoom.makeAction("matchRequest"),[s,r]=this.lobbyRoom.makeAction("matchAccept");setTimeout(()=>n({type:"seeking",id:this.matchmakingId}),500),this.lobbyRoom.onPeerJoin(l=>{console.log("Peer joined lobby:",l),n({type:"seeking",id:this.matchmakingId},l)}),o((l,m)=>{if(l.type==="seeking")if(console.log(`Match request from ${m} with ID ${l.id}. My ID: ${this.matchmakingId}`),this.matchmakingId>l.id){console.log("I am Host");const d=crypto.randomUUID();s({roomId:d},m),this.joinGameRoom(d,!0),this.lobbyRoom.leave(),this.onMatchFoundCallback&&this.onMatchFoundCallback(!0)}else console.log("I am Client (waiting for accept)")}),r((l,m)=>{console.log("Received Match Accept"),this.joinGameRoom(l.roomId,!1),this.lobbyRoom.leave(),this.onMatchFoundCallback&&this.onMatchFoundCallback(!1)})}findMatch(t){this.onMatchFoundCallback=t,this.joinLobby()}joinGameRoom(t,n){this.isHost=n;const o={appId:"connect4-webrtc-game"};this.gameRoom=kt(o,t);const[s,r]=this.gameRoom.makeAction("move"),[l,m]=this.gameRoom.makeAction("surrender"),[d,p]=this.gameRoom.makeAction("rematch"),[u,c]=this.gameRoom.makeAction("quit");this.sendMoveAction=s,this.sendSurrenderAction=l,this.sendRematchAction=d,this.sendQuitAction=u,r((i,g)=>{this.onMoveReceivedCallback&&this.onMoveReceivedCallback(i)}),m((i,g)=>{this.onSurrenderReceivedCallback&&this.onSurrenderReceivedCallback()}),p((i,g)=>{this.onRematchReceivedCallback&&this.onRematchReceivedCallback()}),c((i,g)=>{this.onQuitReceivedCallback&&this.onQuitReceivedCallback()}),this.gameRoom.onPeerLeave(i=>{this.onPeerDisconnectCallback&&this.onPeerDisconnectCallback()})}sendMove(t){this.sendMoveAction&&this.sendMoveAction({col:t})}sendSurrender(){this.sendSurrenderAction&&this.sendSurrenderAction({})}sendRematch(){this.sendRematchAction&&this.sendRematchAction({})}sendQuit(){this.sendQuitAction&&this.sendQuitAction({})}onMoveReceived(t){this.onMoveReceivedCallback=t}onSurrenderReceived(t){this.onSurrenderReceivedCallback=t}onRematchReceived(t){this.onRematchReceivedCallback=t}onQuitReceived(t){this.onQuitReceivedCallback=t}onPeerDisconnect(t){this.onPeerDisconnectCallback=t}leaveGameRoom(){this.gameRoom&&(this.gameRoom.leave(),this.gameRoom=null)}}const H=new on,Y=new as,cs={elements:{status:document.getElementById("status"),findMatchBtn:document.getElementById("find-match-btn"),lobbyStatus:document.getElementById("lobby-status"),gameBoard:document.getElementById("game-board"),surrenderBtn:document.getElementById("surrender-btn"),lobbyControls:document.getElementById("lobby-controls"),modal:document.getElementById("game-modal"),modalTitle:document.getElementById("modal-title"),modalMessage:document.getElementById("modal-message"),modalRematchBtn:document.getElementById("modal-rematch-btn"),modalQuitBtn:document.getElementById("modal-quit-btn")},state:{inGame:!1,isMyTurn:!1,myPlayerId:null,startingPlayer:1,localRematch:!1,remoteRematch:!1},init(){this.elements.findMatchBtn.addEventListener("click",()=>this.findMatch()),this.elements.surrenderBtn.addEventListener("click",()=>this.surrender()),this.elements.modalRematchBtn.addEventListener("click",()=>this.handleRematchClick()),this.elements.modalQuitBtn.addEventListener("click",()=>this.handleQuitClick()),this.renderBoard(),this.elements.status.textContent="Welcome! Find a match to play."},findMatch(){this.elements.findMatchBtn.classList.add("hidden"),this.elements.lobbyStatus.classList.remove("hidden"),this.elements.status.textContent="Searching for opponent...",Y.findMatch(e=>{this.startGame(e)})},startGame(e){this.state.inGame=!0,this.state.myPlayerId=e?1:2,this.state.startingPlayer=1,this.state.isMyTurn=this.state.myPlayerId===this.state.startingPlayer,this.elements.lobbyControls.classList.add("hidden"),this.elements.gameBoard.classList.remove("hidden"),this.elements.surrenderBtn.classList.remove("hidden"),this.resetRematchState(),this.updateStatus(),Y.onMoveReceived(t=>{this.handleRemoteMove(t.col)}),Y.onSurrenderReceived(()=>{this.handleSurrenderReceived()}),Y.onRematchReceived(()=>{this.handleRematchReceived()}),Y.onQuitReceived(()=>{this.handleQuitReceived()}),Y.onPeerDisconnect(()=>{this.handlePeerDisconnect()})},handlePeerDisconnect(){this.state.inGame=!1,Y.leaveGameRoom(),this.closeModal(),this.elements.gameBoard.classList.add("hidden"),this.elements.surrenderBtn.classList.add("hidden"),this.elements.lobbyControls.classList.remove("hidden"),this.elements.findMatchBtn.classList.remove("hidden"),this.elements.lobbyStatus.classList.add("hidden"),this.elements.status.textContent="Opponent disconnected. Returned to lobby.",this.elements.status.style.color="var(--text-color)",this.resetBoardUI(),H.reset()},updateStatus(){if(H.winner){H.winner===this.state.myPlayerId?(this.elements.status.textContent="You Won! ðŸŽ‰",this.showModal("You Won!","Congratulations! You won the game.")):(this.elements.status.textContent="You Lost ðŸ˜”",this.showModal("You Lost","Better luck next time."));return}this.state.isMyTurn?(this.elements.status.textContent="Your Turn",this.elements.status.style.color=this.state.myPlayerId===1?"var(--player1-color)":"var(--player2-color)"):(this.elements.status.textContent="Opponent's Turn",this.elements.status.style.color="var(--text-color)")},renderBoard(){this.elements.gameBoard.innerHTML="";for(let e=0;e<H.rows;e++)for(let t=0;t<H.cols;t++){const n=document.createElement("div");n.className="cell",n.dataset.row=e,n.dataset.col=t,n.addEventListener("click",()=>this.handleCellClick(t)),this.elements.gameBoard.appendChild(n)}},handleCellClick(e){if(!this.state.inGame||!this.state.isMyTurn||H.winner)return;const t=H.dropPiece(e);t&&(this.updateBoardUI(t.row,t.col,t.player),Y.sendMove(e),this.state.isMyTurn=!1,this.updateStatus())},handleRemoteMove(e){const t=H.dropPiece(e);t&&(this.updateBoardUI(t.row,t.col,t.player),this.state.isMyTurn=!0,this.updateStatus())},updateBoardUI(e,t,n){const o=e*H.cols+t,s=this.elements.gameBoard.children[o];s&&s.classList.add(n===1?"player1":"player2")},surrender(){!this.state.inGame||H.winner||(Y.sendSurrender(),this.state.inGame=!1,this.showModal("You Resigned","You surrendered the game."),this.elements.status.textContent="You Resigned")},handleSurrenderReceived(){!this.state.inGame||H.winner||(this.state.inGame=!1,this.showModal("Opponent Resigned","You won! The opponent resigned."),this.elements.status.textContent="Opponent Resigned")},showModal(e,t){this.elements.modalTitle.textContent=e,this.elements.modalMessage.textContent=t,this.elements.modal.classList.remove("hidden"),this.elements.modalRematchBtn.disabled=!1,this.elements.modalRematchBtn.textContent="Rematch"},closeModal(){this.elements.modal.classList.add("hidden")},handleRematchClick(){this.state.localRematch=!0,this.elements.modalRematchBtn.disabled=!0,this.elements.modalRematchBtn.textContent="Waiting...",Y.sendRematch(),this.checkRematch()},handleRematchReceived(){this.state.remoteRematch=!0,!this.state.localRematch&&!this.elements.modal.classList.contains("hidden")&&(this.elements.modalMessage.textContent+=" (Opponent wants a rematch!)"),this.checkRematch()},checkRematch(){this.state.localRematch&&this.state.remoteRematch&&setTimeout(()=>this.restartGame(),500)},restartGame(){this.closeModal(),this.resetRematchState(),this.state.startingPlayer=this.state.startingPlayer===1?2:1,H.reset(),this.resetBoardUI(),this.state.inGame=!0,this.state.isMyTurn=this.state.myPlayerId===this.state.startingPlayer,this.updateStatus()},handleQuitClick(){Y.sendQuit(),this.returnToLobby()},handleQuitReceived(){this.elements.modalRematchBtn.disabled=!0,this.elements.modalRematchBtn.textContent="Opponent Left",this.elements.modalMessage.textContent="Opponent has left the game."},returnToLobby(){this.handlePeerDisconnect()},resetRematchState(){this.state.localRematch=!1,this.state.remoteRematch=!1},resetBoardUI(){Array.from(this.elements.gameBoard.children).forEach(e=>{e.classList.remove("player1","player2")})}};cs.init();
